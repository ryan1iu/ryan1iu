---
title: 链接装载与库
description: null
date: 2025-01-05T07:15:01.000Z
image: null
math: null
license: null
hidden: false
comments: true
draft: true
categories:
  - 笔记
---
# 链接
链接是将多个目标文件和库文件组合成可执行文件的过程，目标文件通常由编译器生成，而库提供了程序运行所需要的额外功能（如标准库中的函数）。链接可以分为以下两种类型

## 静态链接
- 概念
    - 在链接阶段，将目标文件和库中的代码合并到最终的可执行文件中。
    - 链接完成后，不需要额外的库文件支持。
- 优点
    - 运行时无需额外的依赖，单个可执行文件即可运行
    - 性能更高，因为不需要动态查找和加载库函数。
- 缺点
    - 可执行文件体积较大
    - 如果库更新，需要重新链接生成可执行文件
- 使用场景
    - 在嵌入式系统中通常使用静态链接以减少运行时依赖

## 动态链接
- 概念
    - 在运行时加载所需的库（如.so 或 .dll 文件）
    - 链接器将可执行文件与动态库之间建立一种引用关系
- 优点
    - 可执行文件体积较小
    - 库的更新无需重新编译和链接可执行文件
- 缺点
    - 程序运行时依赖动态库，可能出现库版本兼容性问题
    - 动态加载库会增加程序启动时间
- 使用场景
    - 大型软件系统，操作系统（如Linux下的动态库.so）

# 装载
## 装载器的职责
1. 加载程序代码和数据
    将程序的代码段和数据段加载到内存中
2. 动态链接库加载
    如果程序使用动态链接库，装载器会加载相关动态库到内存
3. 初始化
    设置程序的入口点，初始化全局变量，准备运行

## 装载的分类
- 静态装载
    在程序启动前完成所有的装载和链接操作，程序运行时不再加载新的库或模块
- 动态装载
    在程序运行期间，根据需要动态加载某些模块或库。通过函数（如dlopen() 和 dlsym() 动态加载和调用
    库中的函数

# 库
库是一组可以被多个程序复用的预编译代码，通常包含各种功能的实现（如数学运算、文件操作），库分为两大类

## 静态库
- 文件格式
    在Linux中通常为.a 文件（archive), 在Windows中为.lib文件
- 使用方式
    静态库的代码在编译时被直接链接到目标文件中
- 优点和缺点
    与静态链接优缺点相同
- 创建和使用
    1. 创建静态库
        ```bash
        ar rcs libmylib.a file1.o file2.o
        ```
    2. 使用静态库
        ```c
        gcc -o myprogram main.o -L. -lmylib
        ```

## 动态库
在Linux中通常为.so文件，动态库的代码在运行时加载到内存中，程序通过动态链接器访问库函数
- 创建和使用
    1. 创建动态库
        ```bash
        gcc -shared -o libmylib.so file.o file2.o
        ```
    2. 使用动态库
        ```bash
        gcc -o myprogram main.o -L. -lmylib
        ```



